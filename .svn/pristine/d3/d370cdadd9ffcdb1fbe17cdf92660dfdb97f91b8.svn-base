app.controller('mapController', function ($scope,$http) {
    var items = [];

    var addressPointsToMarkers = function (points) {
        return points.map(function (ap) {
            return items.push({
                layer: 'track',
                lat: ap[1],
                lng: ap[2],
                icon: icons.red
            });
        });
    };
    var addressPointsToMarkers2 = function (points) {
        return points.map(function (ap) {
            return items.push({
                layer: 'track',
                lat: ap[1],
                lng: ap[2],
                icon: icons.blue
            });
        });
    };

    var icons = {
        blue:{
            type: 'div',
            iconSize: [10, 10],
            className: 'blue',
            iconAnchor:  [5, 5]
        },
        red: {
            type: 'div',
            iconSize: [10, 10],
            className: 'red',
            iconAnchor:  [5, 5]
        },
        adsb: {
            iconUrl: '/images/marker-icon.png'
        },
        ssr: {
            iconUrl: '/images/red-marker.png'
        }
    }

    angular.extend($scope, {
        bangkok: {
            lat: 13.715560,
            lng: 100.540599,
            zoom: 6
        },
        layers: {
            baselayers: {
                openStreetMap: {
                    name: 'OpenStreetMap',
                    type: 'xyz',
                    url: 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'
                }
            },
            overlays: {
                ssr: {
                    type: 'group',
                    name: 'SSR',
                    visible: false
                },

                adsb: {
                    type: 'group',
                    name: 'ADS-B',
                    visible: false
                },
                track: {
                    type: 'group',
                    name: 'Track',
                    visible: false
                }
            }
        },

        toggleLayer: function (type) {
            $scope.layers.overlays[type].visible = !$scope.layers.overlays[type].visible;
        }
    });

    $http.get('/Data/21_136.json')
       .then(function (res) {
           addressPointsToMarkers(res.data);
           console.log(res.data);
           console.log("1Http"+items);
       });
    $http.get('/Data/62_106.json')
       .then(function (res) {
           addressPointsToMarkers2(res.data);
           console.log(res.data);
           console.log("2Http"+items);
       });
    console.log(items)
    $scope.markers = items;
});